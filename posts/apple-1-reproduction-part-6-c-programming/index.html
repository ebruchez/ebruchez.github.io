<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Building an Apple-1 Reproduction in 2024/2025 - Part 6: C Programming" /><meta name="author" content="Erik Bruchez" /><meta property="og:locale" content="en_US" /><meta name="description" content="This is part of a series of posts about building an Apple-1 reproduction in 2024 (and 2025). See also:" /><meta property="og:description" content="This is part of a series of posts about building an Apple-1 reproduction in 2024 (and 2025). See also:" /><link rel="canonical" href="https://blog.bruchez.name/posts/apple-1-reproduction-part-6-c-programming/" /><meta property="og:url" content="https://blog.bruchez.name/posts/apple-1-reproduction-part-6-c-programming/" /><meta property="og:site_name" content="Erik’s Ponderings" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-01-25T14:00:00-08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Building an Apple-1 Reproduction in 2024/2025 - Part 6: C Programming" /><meta name="twitter:site" content="@ebruchez" /><meta name="twitter:creator" content="@Erik Bruchez" /><meta name="google-site-verification" content="irueyGKya5E07oltkTU3FJThmPxkQy-n1W1GOClvPIQ" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Erik Bruchez"},"dateModified":"2025-07-15T15:45:47-07:00","datePublished":"2025-01-25T14:00:00-08:00","description":"This is part of a series of posts about building an Apple-1 reproduction in 2024 (and 2025). See also:","headline":"Building an Apple-1 Reproduction in 2024/2025 - Part 6: C Programming","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.bruchez.name/posts/apple-1-reproduction-part-6-c-programming/"},"url":"https://blog.bruchez.name/posts/apple-1-reproduction-part-6-c-programming/"}</script><title>Building an Apple-1 Reproduction in 2024/2025 - Part 6: C Programming | Erik's Ponderings</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/public/headshot.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Erik's Ponderings</a></div><div class="site-subtitle font-italic">A blog and More</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/pages/" class="nav-link"> <i class="fa-fw fas fa-file ml-xl-3 mr-xl-3 unloaded"></i> <span>PAGES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ebruchez" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/ebruchez" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['erik','bruchez.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://feeds.feedburner.com/EriksPondering" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Building an Apple-1 Reproduction in 2024/2025 - Part 6: C Programming</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Building an Apple-1 Reproduction in 2024/2025 - Part 6: C Programming</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jan 25, 2025, 2:00 PM -0800" > Jan 25 <i class="unloaded">2025-01-25T14:00:00-08:00</i> </span> by <span class="author"> Erik Bruchez </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Jul 15, 2025, 3:45 PM -0700" > Jul 15 <i class="unloaded">2025-07-15T15:45:47-07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2351 words">13 min</span></div><div class="post-meta mb-3"> <a href='/categories/technology/'>Technology</a></div></div><div class="post-content"><p>This is part of a series of posts about building an Apple-1 reproduction in 2024 (and 2025). See also:</p><ul><li><a href="../apple-1-reproduction-part-1-components/">Building an Apple-1 Reproduction in 2024 - Part 1: Components</a><li><a href="../apple-1-reproduction-part-2-power-supply/">Building an Apple-1 Reproduction in 2024 - Part 2: Power Supply</a><li><a href="../apple-1-reproduction-part-3-retro-chip-tester/">Building an Apple-1 Reproduction in 2024 - Part 3: The Retro Chip Tester</a><li><a href="../apple-1-reproduction-part-4-assembly/">Building an Apple-1 Reproduction in 2024 - Part 4: Assembly</a><li><a href="../apple-1-reproduction-part-5-monitor-keyboard-power-up/">Building an Apple-1 Reproduction in 2024 - Part 5: Monitor, Keyboard, Power-Up</a><li><a href="../apple-1-reproduction-part-7-audio-cassette-adapter/">Building an Apple-1 Reproduction in 2024/2025 - Part 7: The Audio Cassette Adapter</a></ul><figure> <img src="/assets/posts/apple1/2x/IMG_1490.jpg" alt="Demo application written in C" width="75%" /><figcaption>Demo application written in C</figcaption></figure><h2 id="programming-the-apple-1">Programming the Apple-1</h2><p>Back in the days, the obvious choices for programming the Apple-1 were assembly language and BASIC. The former, because it was the most direct way: the Apple-1, thanks to WOZMON, allowed you to enter 6502 instructions in hexadecimal directly into memory, and then to run them. You would probably build your program in assembly on paper (or in your head), then “assemble” by hand into hexadecimal. Over time, you would learn the opcodes by heart. Many programmers got started this way on all sorts of systems.</p><p>BASIC was much easier to learn, but you needed to get the Apple-1 ACI (Audio Cassette Interface) to load it into memory. Apple-1 BASIC was written by Woz entirely in assembly, and it was a marvel of compactness and efficiency as it fit in 4K of memory.<sup id="fnref:microsoft-basic"><a href="#fn:microsoft-basic" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></p><p>Here is part of the cover of the Apple BASIC manual reproduction, made with love by Armin in Germany:</p><figure> <img src="/assets/posts/apple1/2x/IMG_3042.jpg" alt="Apple-1 BASIC manual cover (reproduction)" /><figcaption>Apple-1 BASIC manual cover (reproduction)</figcaption></figure><p>In any case, after building my Apple-1 reproduction, I wanted to write some software for it, however simple.</p><h2 id="why-the-c-language">Why the C language?</h2><p>I didn’t think that assembly or BASIC were ideal for me. While 6502 assembly is probably the way to go to optimize performance and code size, it is also a very low-level language, and I thought that it would take me too much effort to get really fluent in the 6502 dialect. I never really learned 6502 assembly in its heyday, although I did peruse the great Commodore 64 manual.<sup id="fnref:assembly"><a href="#fn:assembly" class="footnote" rel="footnote" role="doc-noteref">2</a></sup> BASIC is, of course, much higher-level, but it is also very limited, and not challenging enough.</p><figure> <img src="/assets/posts/apple1/2x/c-logo.svg" alt="C programming language logo" /><figcaption>C programming language logo</figcaption></figure><p>Instead, I decided to try to write in C. It is a good compromise: it is a higher-level language compared to assembly, with functions, types, structs, enumerations, loops, and flexible ways to deal with memory, but it is also very close to the hardware. The resulting program can be burned into an EPROM. Further, I knew C reasonably well at some point in the 1990s so it should come back. But could it work on the Apple-1?</p><h2 id="c-and-the-apple-1">C and the Apple-1</h2><p>At the time the Apple-1 came out in 1976, C was already a thing, kind of: the Unix kernel was rewritten in the brand new C language around 1973. But C didn’t become really public until 1978, when the first edition of the K&amp;R book was published. So it’s not surprising that C wasn’t available on the Apple-1. In addition, C required a compiler, which could easily run on a larger system like the PDP-11, but wouldn’t have been possible on anything as limited as the Apple-1, certainly not in the default memory configuration and without mass storage.<sup id="fnref:small-c"><a href="#fn:small-c" class="footnote" rel="footnote" role="doc-noteref">3</a></sup> It took the general availability of 16-bit systems to make C a practical language for microcomputers.<sup id="fnref:c-compilers-history"><a href="#fn:c-compilers-history" class="footnote" rel="footnote" role="doc-noteref">4</a></sup></p><p>But nowadays, we have <em>cross-compilers</em> that can generate 6502 code, so the story is completely different. There are at least two possibilities:</p><ul><li><a href="https://cc65.github.io/">cc65</a><li><a href="https://github.com/llvm-mos/llvm-mos">LLVM-MOS</a></ul><p>I had to choose which one to try first, and I went with cc65, as it seemed simpler and more lightweight, although it might not generate highly optimized code. Also, it has been around for decades now.</p><h2 id="installation">Installation</h2><p>I first installed <code class="language-plaintext highlighter-rouge">cc65</code> on my Mac using <a href="https://brew.sh/">Homebrew</a>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>brew <span class="nb">install </span>cc65
</pre></table></code></div></div><p>I couldn’t find setup instructions for the Apple-1. Someone mentioned the Apple-1 in a forum around 2013, but that’s all I could find. So I read some of the documentation, and it turns out that the main thing you need is to create a linker configuration file. I created a file called <code class="language-plaintext highlighter-rouge">apple1.ld65</code> (this is just my own naming). But what should be in it? A C program consists of:</p><ul><li>code, which can be in read-only memory or read-write memory<li>initialized data, which can be read-only or read-write<li>uninitialized data</ul><p>In addition, the C runtime needs:</p><ul><li>some “zero page” configuration<li>a place for the CPU stack<li>a place for the C stack</ul><p>On the other hand, my hardware Apple-1 has:</p><ul><li>8 KB of DRAM at address <code class="language-plaintext highlighter-rouge">0x0000</code><li>an EPROM extension board which can hold up to 4 KB of memory (2732 EPROM) at address <code class="language-plaintext highlighter-rouge">0xE000</code></ul><p>The linker script configures where everything goes. Here is the configuration I came up with, after a few tries:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>SYMBOLS {
  __STACKSIZE__: value = $800, type = weak; # 2KB stack
}

MEMORY {
    ZP:    start = $0020, size = $00C0, define = yes; # needs to be at least $1A long (26 bytes) for cc65
    RAM:   start =  $200, size = $1E00, define = yes; # RAM after "6502 stack storage" and fills up to 8KB
    ROM1:  start = $E000, size = $1000, file = "eprom_e000.bin";
}

SEGMENTS {
    ZEROPAGE: load = ZP,   type = zp,  define = yes;
    STARTUP:  load = ROM1, type = ro;
    ONCE:     load = ROM1, type = ro,  optional = yes;
    CODE:     load = ROM1, type = ro;
    RODATA:   load = ROM1, type = ro;
    DATA:     load = ROM1, type = rw,  run = RAM, define = yes;
    BSS:      load = RAM,  type = bss, define = yes;
}

FEATURES {
    STARTADDRESS: default = $E000;
    CONDES: segment = STARTUP, type = constructor, label = __CONSTRUCTOR_TABLE__, count = __CONSTRUCTOR_COUNT__;
    CONDES: segment = STARTUP, type = destructor,  label = __DESTRUCTOR_TABLE__,  count = __DESTRUCTOR_COUNT__;
}
</pre></table></code></div></div><p>The result of a compilation’s linker pass will produce a <code class="language-plaintext highlighter-rouge">eprom_e000.bin</code> file that can be loaded into a 4 KB EPROM located at address 0xE000.</p><h2 id="c-library">C library</h2><p>You need to create a <code class="language-plaintext highlighter-rouge">crt0.s</code> file, which is the entry point of the program. <a href="https://github.com/ebruchez/apple1-party/blob/main/crt0.s">Here is mine</a>, copied from existing examples.</p><p>You also need to create a library file if you want to use any C library functions that come with <code class="language-plaintext highlighter-rouge">cc65</code>. Note that <code class="language-plaintext highlighter-rouge">cc65</code> doesn’t come with the entire standard C library, but with a subset of it. I called my library <code class="language-plaintext highlighter-rouge">apple1.lib</code>. The recommendation from the doc is to copy it from the <code class="language-plaintext highlighter-rouge">supervision.lib</code> file that comes with <code class="language-plaintext highlighter-rouge">cc65</code>. Here is how you can do it:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">cp</span> /opt/homebrew/Cellar/cc65/2.19/share/cc65/lib/supervision.lib apple1.lib
ca65 crt0.s
ar65 a apple1.lib crt0.o
</pre></table></code></div></div><p>You then compile, assemble, and link your C program like this:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>cc65 <span class="nt">-t</span> none <span class="nt">-O</span> main.c
ca65 main.s
ld65 <span class="nt">-C</span> apple1.ld65 <span class="nt">-m</span> main.map main.o apple1.lib
</pre></table></code></div></div><p>Finally, here is how I write the EPROM, using my very basic USB EPROM programmer:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>minipro <span class="nt">-s</span> <span class="nt">-p</span> 2732A@DIP24 <span class="nt">-w</span> eprom_e000.bin
</pre></table></code></div></div><figure> <img src="/assets/posts/apple1/2x/IMG_1591.jpg" alt="EPROM programming and erasing setup" /><figcaption>EPROM programming and erasing setup</figcaption></figure><p>Note that you don’t want to type or rerun individual commands all the time, so I wrote a simple <a href="https://github.com/ebruchez/apple1-party/blob/main/Makefile">Makefile</a> for this.</p><h2 id="first-issue">First issue</h2><p>I was able to pretty quickly compile and run a simple <a href="https://www.youtube.com/watch?v=gQ6mwbTGXGQ">“HELLORLD” program</a>. However, when trying to run a simple <code class="language-plaintext highlighter-rouge">for</code> loop, it didn’t seem to work. How could something that simple fail?</p><p>After a lot of debugging, I found that the call to the <code class="language-plaintext highlighter-rouge">incax1</code> <a href="https://en.wikipedia.org/wiki/Intrinsic_function">intrinsic</a> was not, in fact, incrementing the <code class="language-plaintext highlighter-rouge">ax</code> register pair. I used, for debugging, things like this, which call into WOZMON’s <code class="language-plaintext highlighter-rouge">FFDC</code> routine to print an hex value:</p><pre><code class="language-6502">pha
jsr	    $ffdc
pla
</code></pre><p>The reason for this was that the <code class="language-plaintext highlighter-rouge">supervision.lib</code> I used as the base for my C library was not compiled with plain 6502 instructions. In particular, it used the <code class="language-plaintext highlighter-rouge">INC A</code> increment instruction, <a href="https://en.wikipedia.org/wiki/WDC_65C02#New_and_modified_instructions">available with the 65C02</a> which came out in 1983, but not my 1979 6502!</p><figure> <img src="/assets/posts/apple1/2x/IMG_3044.jpg" alt="My Synertek 6502 CPU made in July 1979" /><figcaption>My Synertek 6502 CPU made in July 1979</figcaption></figure><p>So I had to do it the hard way and recompile the library for a plain 6502 target:</p><ul><li>I cloned the <code class="language-plaintext highlighter-rouge">cc65</code> project from GitHub.<li>I updated <code class="language-plaintext highlighter-rouge">libsrc/Makefile</code>:<ul><li>set <code class="language-plaintext highlighter-rouge">--cpu 6502</code><li>kept only the <code class="language-plaintext highlighter-rouge">supervision</code> target</ul><li>I built the library:<ul><li><code class="language-plaintext highlighter-rouge">make lib</code></ul><li>I used this new <code class="language-plaintext highlighter-rouge">supervision.lib</code> as base for <code class="language-plaintext highlighter-rouge">apple1.lib</code>:<ul><li><code class="language-plaintext highlighter-rouge">ar65 a apple1.lib crt0.o</code> again</ul></ul><p>And, success! With this change, I was able to compile a C program with <code class="language-plaintext highlighter-rouge">for</code> loops on the Apple-1.</p><h2 id="memory-allocator">Memory allocator</h2><p>Since I was using C, I wanted to use <code class="language-plaintext highlighter-rouge">malloc</code> and <code class="language-plaintext highlighter-rouge">free</code>. Luckily, these functions are available in the <code class="language-plaintext highlighter-rouge">cc65</code> library. But things didn’t work initially.</p><p>I had to debug various constants, and finally found that I had to move my <code class="language-plaintext highlighter-rouge">BSS</code> after <code class="language-plaintext highlighter-rouge">DATA</code> for malloc to work.</p><p>Here are some values I found:</p><div class="table-wrapper"><table><thead><tr><th>Symbol<th>Value<th>Notes<tbody><tr><td><code class="language-plaintext highlighter-rouge">__BSS_RUN__</code><td><code class="language-plaintext highlighter-rouge">0x23C</code><td>Starting address of the BSS section.<tr><td><code class="language-plaintext highlighter-rouge">__BSS_SIZE__</code><td><code class="language-plaintext highlighter-rouge">0x54</code><td>Size of the BSS section.<tr><td>First address after BSS<td><code class="language-plaintext highlighter-rouge">0x290</code><td>First address after the BSS section (sum of previous two values).<tr><td><code class="language-plaintext highlighter-rouge">__heapmaxavail()</code><td><code class="language-plaintext highlighter-rouge">5484</code><td>Largest available block in the heap (in bytes).<tr><td><code class="language-plaintext highlighter-rouge">__heapmemavail()</code><td><code class="language-plaintext highlighter-rouge">5488</code><td>Total available heap memory (4 bytes more than previous value).<tr><td>First allocation<td><code class="language-plaintext highlighter-rouge">0x29D</code><td>First address allocated by <code class="language-plaintext highlighter-rouge">malloc</code>.</table></div><p>The memory layout ends up being:</p><div class="table-wrapper"><table><thead><tr><th>Function<th>Value<th>Notes<tbody><tr><td>BSS start<td><code class="language-plaintext highlighter-rouge">0x23C</code><td> <tr><td>C heap start<td><code class="language-plaintext highlighter-rouge">0x290</code><td> <tr><td>C heap end<td><code class="language-plaintext highlighter-rouge">0x17FF</code><td> <tr><td>C stack start/RAM end<td><code class="language-plaintext highlighter-rouge">0x1FFF</code><td><code class="language-plaintext highlighter-rouge">__STACKSIZE__</code> is <code class="language-plaintext highlighter-rouge">0x800</code> and stack addresses are in descending order</table></div><p>In conclusion, my <code class="language-plaintext highlighter-rouge">malloc</code> setup now appears fine, with various values in the right place, and I can allocate and free memory with some confidence. Note that:</p><ul><li>each allocation takes 4 bytes of overhead<li>we have 5488 bytes of heap at beginning</ul><p>I could easily reduce the size of my C stack down from 2 KB if I need more usable RAM. I might also be able to recover some RAM in the lower space, after The ZP and CPU stack areas.</p><h2 id="simple-program">Simple program</h2><p>Because I was going to have guests over, and I was going to annoy them with the Apple-1 anyway, I decided to write a simple program that would allow them to check in. So I wrote a simple “Party checkin system” app which would:</p><ul><li>ask guests for their name and number of guests<li>add them to a linked list<li>display the list<li>display the total number of guests<li>allow to remove entries in the list</ul><p>I wrote simple utility functions in <code class="language-plaintext highlighter-rouge">util.c</code>:</p><div class="table-wrapper"><table><thead><tr><th>Function<th>Purpose<th>Description<tbody><tr><td><code class="language-plaintext highlighter-rouge">a1_cputc()</code><td>Write a character to the screen<td>Outputs a single character to the screen at the current cursor position.<tr><td><code class="language-plaintext highlighter-rouge">a1_cputs()</code><td>Write a string to the screen<td>Outputs a null-terminated string to the screen starting at the cursor.<tr><td><code class="language-plaintext highlighter-rouge">a1_cgetc()</code><td>Read a character from the keyboard<td>Reads a single character input from the user.<tr><td><code class="language-plaintext highlighter-rouge">a1_read_line()</code><td>Read a line from the keyboard<td>Reads a full line of input, storing it in a buffer.<tr><td><code class="language-plaintext highlighter-rouge">a1_read_number()</code><td>Read and check a number from the keyboard<td>Accepts and validates numeric input from the user.<tr><td><code class="language-plaintext highlighter-rouge">print_big()</code><td>Print a large number on the screen<td>Displays a number with large, stylized digits made up of smaller characters.</table></div><p>Note that this is all there is to the Apple-1 in terms of I/O, without hardware extensions: you can write characters to the screen, and read characters from the keyboard. That’s it. There are no graphics capabilities, no sound, no network, no storage, no timers: it’s a very simple system!</p><p>My <code class="language-plaintext highlighter-rouge">main.c</code> handles the linked list functions and the main loop.</p><h2 id="coding-tips">Coding tips</h2><p>My C might be rusty, but here are some things I quickly decided to do:</p><ul><li>use <code class="language-plaintext highlighter-rouge">const</code> whenever possible<li>use type aliases for specific widths, such as <code class="language-plaintext highlighter-rouge">uint8_t</code>, <code class="language-plaintext highlighter-rouge">uint16_t</code>, etc.</ul><p>Here is an example of the style I am using:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kt">uint16_t</span> <span class="nf">a1_read_number</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">digits</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a1_cgetc</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="sc">'0'</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">'9'</span> <span class="o">&amp;&amp;</span> <span class="n">digits</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">a1_cputc</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">);</span>
            <span class="n">digits</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">CR</span> <span class="o">&amp;&amp;</span> <span class="n">digits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">number</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="limitations">Limitations</h2><p>It is clear that 4 KB of EPROM is very limiting. Yes, Woz wrote an entire BASIC interpreter in that space, but I am no Woz, and I am not using assembly. A little bit of data, a <code class="language-plaintext highlighter-rouge">cprintf</code> function, <code class="language-plaintext highlighter-rouge">malloc</code>, and a small program will quickly fill up that space. In fact, I had to avoid using <code class="language-plaintext highlighter-rouge">printf()</code>: it is convenient, but it takes significant EPROM space, so I reverted to use lower-level code.</p><p>A possible next step will be to make an EPROM board that supports 8 KB or more of memory. This has been done before for the Apple-1, but I am not sure that there is a solution that I truly like (or that is affordable). I might decide to make my own.</p><p>If the solution is limited to 8 KB, it is possible to use the <code class="language-plaintext highlighter-rouge">S</code> and <code class="language-plaintext highlighter-rouge">T</code> signals on the extension connector. But for more space, one needs to replicate address decoding on the extension card. This is not too hard, but it goes beyond simply connecting one or more EPROMs to the bus.</p><h2 id="conclusion">Conclusion</h2><p>I am really happy that I was able to write a small C program for the Apple-1. It uses functions, <code class="language-plaintext highlighter-rouge">malloc</code>, standard string manipulation functions, creates a linked list, and flawlessly reads from the keyboard and writes to the video terminal.</p><figure> <img src="/assets/posts/apple1/2x/IMG_1490.jpg" alt="Demo application written in C" /><figcaption>Demo application written in C</figcaption></figure><p>You can find the source code for the “Apple-1 Party” app on <a href="https://github.com/ebruchez/apple1-party/tree/main">GitHub</a>.</p><p><a href="../apple-1-reproduction-part-7-audio-cassette-adapter/">Part 7</a> covers the Audio Cassette Interface (ACI).</p><hr /><div class="footnotes" role="doc-endnotes"><ol><li id="fn:microsoft-basic"><p>The same could be said of Bill Gates, Paul Allen, and Monte Davidoff’s 4K version of Microsoft BASIC for the Altair 8800. <a href="#fnref:microsoft-basic" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:assembly"><p>However, I dabbled with a homemade Z80 computer board, I programmed in RCA 1802 assembly on my own boards, and I eventually got some mastery of 68000 assembly (a beautiful processor instruction set architecture). <a href="#fnref:assembly" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:small-c"><p>I learned that <a href="https://en.wikipedia.org/wiki/Small-C">Small-C</a>, a subset of C that could run on 8-bit systems, specifically the 8080 microprocessor, was developed in 1980. <a href="#fnref:small-c" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:c-compilers-history"><p>I found this interesting <a href="https://thechipletter.substack.com/p/a-history-of-c-compilers-part-1-performance">History of C Compilers article</a>. <a href="#fnref:c-compilers-history" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/technology/'>Technology</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Updates</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/vail-resorts-epic-coverage-declined/">Beware of Vail Resorts' Epic Coverage</a><li><a href="/posts/restoring-ibm-memory-typewriter-1/">Restoring an IBM Memory Typewriter - Part 1</a><li><a href="/posts/apple-1-reproduction-part-7-audio-cassette-adapter/">Building an Apple-1 Reproduction in 2024/2025 - Part 7: The Audio Cassette Adapter</a><li><a href="/posts/apple-1-reproduction-part-6-c-programming/">Building an Apple-1 Reproduction in 2024/2025 - Part 6: C Programming</a><li><a href="/posts/apple-1-reproduction-part-3-retro-chip-tester/">Building an Apple-1 Reproduction in 2024 - Part 3: The Retro Chip Tester</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ibm-mt-sc-2/"><div class="card-body"> <span class="timeago small" > Jul 3, 2024 <i class="unloaded">2024-07-03T14:25:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The IBM Magnetic Tape Selectric Composer - Part 2</h3><div class="text-muted small"><p> The IBM Magnetic Tape Selectric Composer (MT/SC) Introduction This is part 2 of a two-part post. See also The IBM Magnetic Tape Selectric Composer - Part 1. In the first part, I placed th...</p></div></div></a></div><div class="card"> <a href="/posts/vic-20-key/"><div class="card-body"> <span class="timeago small" > Jul 24, 2024 <i class="unloaded">2024-07-24T20:25:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Replacing a VIC-20 key</h3><div class="text-muted small"><p> Introduction In late 2023, I acquired a Commodore VIC-20 computer. I had been thinking about getting one (or a Commodore 64) if I could get a good deal, and this was one. It came with a few cartri...</p></div></div></a></div><div class="card"> <a href="/posts/apple-1-reproduction-part-1-components/"><div class="card-body"> <span class="timeago small" > Sep 7, 2024 <i class="unloaded">2024-09-07T11:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building an Apple-1 Reproduction in 2024 - Part 1: Components</h3><div class="text-muted small"><p> This is part 1 of a series of posts about building an Apple-1 reproduction in 2024. See also: Building an Apple-1 Reproduction in 2024 - Part 2: Power Supply Building an Apple-1 Reproduction ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/apple-1-reproduction-part-5-monitor-keyboard-power-up/" class="btn btn-outline-primary" prompt="Older"><p>Building an Apple-1 Reproduction in 2024 - Part 5: Monitor, Keyboard, Power-Up</p></a> <a href="/posts/apple-1-reproduction-part-7-audio-cassette-adapter/" class="btn btn-outline-primary" prompt="Newer"><p>Building an Apple-1 Reproduction in 2024/2025 - Part 7: The Audio Cassette Adapter</p></a></div><div id="disqus_thread"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script> var disqus_config = function() { this.page.url = 'https://blog.bruchez.name/posts/apple-1-reproduction-part-6-c-programming/'; this.page.identifier = '/posts/apple-1-reproduction-part-6-c-programming/'; }; (function() { var d = document; var s = d.createElement('script'); s.src = 'https://ebruchez.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="">Erik Bruchez</a>.</p></div><div class="footer-right"><p class="mb-0"></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://blog.bruchez.name{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
